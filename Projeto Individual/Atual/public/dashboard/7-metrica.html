<!DOCTYPE html>
<html lang="pt-br">

<head>
    <link rel="shortcut icon" href="../assets/icon/2.png" type="image/x-icon">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taste Talks | Métricas </title>

    <script src="../js/sessao.js"></script>
    <link rel="icon" href="./assets/icon/2.png">

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href='https://fonts.googleapis.com/css?family=Montserrat|Cardo' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
    <!-- scripts do Chart.js - 2022-1 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!--FONT AWESOME-->
    <script src="https://kit.fontawesome.com/9f7414eb10.js" crossorigin="anonymous"></script>
</head>

<body onload="iniciarSessao(), pegandoDados(), definirImagemPerfil()">

    <header class="home_header">

        <div class="head">
            <h1 class="logo" href="#">Taste Talks</h1>

            <nav>
                <ul>
                    <li><a href="5-forum.html">Fórum</a></li>
                    <li><a href="7-metrica.html" class="now">Métricas</a></li>
                    <li><a href="8-Game_Home.html">Games</a></li>
                    <li>|</li>
                    
                    <img class="fotoPerfil" id="foto_perfil" src="" alt="imagem de perfil">
                    <li>Olá,<div class="nick" id="id_apelido">!</div></li>
                    <li><a href="../index.html" class="exit">Sair</a></li>
                </ul>
            </nav>

        </div> <!-- / head -->

    </header>

    <div class="content">
        <div class="grafico">
            <h2>Ranking de avaliações dos restaurantes citados pelos usuários no Fórum</h2> <br>
            <canvas id="avaliacaoRestaurantes"></canvas>
        </div>

        <div class="grafico">
            <h2>Porcentagem dos paises de culinária favorita entre os usuários</h2> <br>
            <canvas id="CulinariaFav"></canvas>
        </div>

    <!--
        <div class="grafico">
            <h2> Nota por Quiz </h2> <br>
            <canvas id="AcertosQuiz"></canvas>
        </div>

        <div class="grafico">
            <h2> Nota por Cruzadinha </h2> <br>
            <canvas id="ErrosCruzadinha"></canvas>
        </div>
-->

<center>
    <div class="grafico">
        <aside>
            <section class="ranking">
                <div class="posicao">
                    <div class="head">
                        <h2> Players no Ranking Global</h2>
                    </div>
                    <div class="player" id="posicaoUser">

                    </div>

                    <div class="player" id="posicaoJogadores">

                    </div>

                </div>
            </section>
        </aside>
    </div>
</center>
        


    </div>

    <!-- Site footer -->
    <footer class="site-footer">
        <div class="container">
            <div class="footer-row">
                <div class="footer-col">
                    <p class="copyright-text">Copyright &copy; 2024 Todos os direitos reservados
                        <a href="#">Luiza C. Moreira</a> SPTECH.
                    </p>
                </div>

                <div class="footer-col3">
                    <ul class="social-icons">
                        <li><a class="github" href="#"><i class="fa fa-github"></i></a></li>
                        <li><a class="linkedin" href="#"><i class="fa fa-linkedin"></i></a></li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>

    <style>
        body {
            color: #8f8f8f;
            font-family: "Cardo", serif;
            font-weight: 300;
            background-color: white;
            -webkit-font-smoothing: antialiased;
            margin: 0;
        }

        a {
            text-decoration: none;
        }

        h1 {
            font-size: 30px;
            line-height: 1.8;
            text-transform: uppercase;
            font-family: "Montserrat", sans-serif;
        }

        p {
            margin-bottom: 20px;
            font-size: 17px;
            line-height: 2;
            text-align: justify;
            margin-right: 3%;
        }

        h3 {
            font-family: sans-serif;
            font-weight: bold;
            color: #EE9B00;
            margin-top: -5px;
        }

        /* ------ HEADER ----- */
        .home_header {
            position: fixed;
            z-index: 999;
            width: 100%;
            padding-top: 2%;
            transition: all 0.3s;
            top: 0px;
            padding-bottom: 6px;
            background-color: rgba(255, 255, 255, 0.93);
            border-bottom: 1px solid gainsboro;
            opacity: 1;
            top: 0px;
        }

        .home_header a {
            text-decoration: none;
            text-align: right;

        }

        .home_header a:hover {
            font-weight: bold;
            font-size: 12px;
            color: #BB3E03;
        }

        .logo {
            width: 300px;
            font-size: 40px;
            font-weight: bolder;
            color: #CA6702;
            text-transform: uppercase;
            float: left;
            display: block;
            margin-top: -2%;
            margin-bottom: 2px;
            text-decoration: none;
        }

        .now {
            font-weight: bold;
            color: #ffe3d3;
            background-color: #EE9B00;
            padding: 8px;
            border-radius: 10px;
        }

        .exit {
            font-weight: bold;
            color: #ca6602b8;
            background-color: #ee9b004f;
            padding: 8px;
            border-radius: 10px;
        }

        .exit:hover {
            font-weight: bold;
            color: #ca6602;
            background-color: #ee9b00bc;
            padding: 8px;
            border-radius: 10px;
        }

        nav {
            float: right;
            width: 71%;
        }

        nav ul {
            text-align: right;
            float: right;
        }

        nav ul li {
            display: inline-block;
            margin-left: 35px;
        }

        nav ul li .nick{
            display: contents;
        }

        .fotoPerfil{
            width: 5%; 
            border: 100%; 
            margin-bottom: -10px; 
            display: flexbox; 
            margin-left: 10px; 
            margin-right: -18px;
        }

        nav ul a {
            color: #888888;
            text-transform: uppercase;
            font-size: 12px;
        }

        .head {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
        }


        .content {
            align-items: center;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 50px;
            padding: 5%;
            margin: 4%;
            text-align: center;
            width: 90%;
        }

        .dificuldade {
            border: 2px solid #BB3E03;
            background-color: #bb3d03a4;
            color: #E9D8A6;
            font-size: larger;
            text-align: center;
            border-radius: 10px;
        }

        .content .grafico {
            background-color: #d8b898;
            padding: 40px;
            border-radius: 30px;
        }

        .content .grafico h2 {
            font-family: "Montserrat", sans-serif;
            color: #402610;
            font-weight: 700;
            font-size: 25px;
        }

        .content canvas {
            position: relative;
            height: 40vh;
            width: 100%;
        }

        /* ---- Section Emergência ---- */
        aside {
            grid-template-columns: 22rem auto;
            width: 100%;
            font-size: small;
            font-family: "Montserrat", sans-serif;
            font-weight: 100;
            align-items: center;

        }

        aside section.ranking .posicao {
            background-color: #bb3d03aa;
            align-items: center;
        }

        aside section.ranking .posicao img {
            width: 12%;
        }

        aside section.ranking .posicao .head {
            padding: 15px;
            align-items: center;
            background-color: #BB3E03;
            border-bottom: 1px solid #F2C197;
        }

        aside section.ranking .posicao .head h2 {
            color: #fff;
        }

        aside section.ranking .posicao .player {
            display: block;
            padding: 4px;
            border-bottom: 2px solid #F2C197;
            transition: all 300ms ease;
        }

        aside section.ranking .posicao .player h4 {
            text-align: center;
            align-items: center;
        }

        aside section.ranking .posicao .player .dados p {
            margin-bottom: 2px;
            text-align: center;
            align-items: center;
        }

        aside section.ranking .posicao .player:hover {
            background-color: #bb3d034d;
            width: 99%;
        }

        /*FOOTER*/
        .site-footer {
            background-color: #26272b;
            padding: 40px 30px 20px;
            font-size: 15px;
            line-height: 24px;
            color: #E9D8A6;
        }

        .site-footer hr {
            border-top-color: #E9D8A6;
            opacity: 0.5;
        }

        .site-footer h6 {
            color: #EE9B00;
            font-size: 16px;
            text-transform: uppercase;
            margin-top: 5px;
            letter-spacing: 2px;
        }

        .site-footer a {
            color: #E9D8A6;
            text-decoration: none;
        }

        .site-footer a:hover {
            color: #CA6702;
        }

        .footer-links {
            padding-left: 0;
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 10px;
        }

        .footer-links a {
            color: #ee9b00be;
            text-decoration: none;
        }

        .footer-links a:hover {
            color: #CA6702;
        }

        .text-justify {
            text-align: justify;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        .footer-row {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
        }

        .footer-col {
            width: 60%;
            margin-bottom: 20px;
        }

        .footer-col2 {
            width: 30%;
            margin-bottom: 20px;
        }

        .footer-col3 {
            flex: 1;
            width: 60%;
            margin-bottom: 20px;
        }

        .footer-col a {
            color: #94D2BD;
        }

        .footer-col a:hover {
            color: #509e85;
        }

        .copyright-text {
            color: #94D2BD;
        }

        .social-icons {
            list-style: none;
            padding-left: 0;
            display: flex;
            justify-content: flex-end;
        }

        .social-icons li {
            margin-left: 10px;
        }

        .social-icons a {
            background-color: #eceeef;
            color: #818a91;
            font-size: 16px;
            display: inline-block;
            text-align: center;
            width: 40px;
            height: 40px;
            line-height: 40px;
            border-radius: 10px;
            transition: all 0.2s linear;
        }

        .social-icons a:hover {
            color: #fff;
            background-color: #9db0bd;
        }

        .social-icons a.github:hover {
            background-color: #6003ad;
        }

        .social-icons a.linkedin:hover {
            background-color: #0b85be;
        }
    </style>

    <script>
         var usuario = sessionStorage.ID_USUARIO;

        //variaveis da culinária favorita - parte cadastro
        var ItaliaCF = 0;
        var FrancaCF = 0;
        var JapaoCF = 0;
        var MexicoCF = 0;
        var EgitoCF = 0;
        var BrasilCF = 0;
        var ArabiaCF = 0;
        var EuaCF = 0;

        function definirImagemPerfil() {
    var pais = sessionStorage.PAIS_USUARIO;
    var imgSrc;

    switch (pais) {
        case 'IT':
            imgSrc = "../assets/italia.png";
            break;
        case 'FR':
            imgSrc = "../assets/franca.png";
            break;
        case 'JP':
            imgSrc = "../assets/japao.png";
            break;
        case 'MX':
            imgSrc = "../assets/mexico.png";
            break;
        case 'EG':
            imgSrc = "../assets/egito.png";
            break;
        case 'BR':
            imgSrc = "../assets/brasil.png";
            break;
        case 'SA':
            imgSrc = "../assets/arabia.png";
            break;
        case 'US':
            imgSrc = "../assets/eua.png";
            break;
        default:
            imgSrc = "https://cdn-icons-png.flaticon.com/128/149/149071.png";
            break;
    }

    document.getElementById('foto_perfil').src = imgSrc;
}

        function pegandoDados() {
            var usuario = sessionStorage.ID_USUARIO;

            // fetch Ranking global
            fetch("/quiz/exibirTotal", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    usuarioServer: usuario,
                })
            }).then(function (resposta) {
                if (resposta.ok) {
                    if (resposta.status == 204) {
                        alert('Nenhuma resposta');
                        return; // Sair da função se não houver resposta
                    }

                    return resposta.json(); // Convertendo a resposta para JSON
                } else {
                    throw "Houve um erro na API!";
                }
            }).then(function (resposta) {
                if (!resposta) return; // Se a resposta for undefined, sair da função

                var lista_rankTotal = [];

                // Adiciona os IDs dos usuários na lista
                for (var i = 0; i < resposta.length; i++) {
                    var ranking = resposta[i];
                    var id_ranking = ranking.id;
                    lista_rankTotal.push(id_ranking);
                }

                // Ordena a lista em ordem decrescente (caso não esteja ordenada)
                lista_rankTotal.sort(function (a, b) {
                    return b - a;
                });

                // Encontra a posição do usuário na lista
                var posicaoUsuario = lista_rankTotal.indexOf(parseInt(usuario));

                // Exibe a posição do usuário
                console.log(`A posição do usuário ${usuario} na lista é: ${posicaoUsuario}`);

                var divPosicaoUser = document.getElementById('posicaoUser');
                var divPosicaoPlayer = document.getElementById('posicaoJogadores');

                // Limpar as divs antes de adicionar novos elementos
                divPosicaoUser.innerHTML = '';
                divPosicaoPlayer.innerHTML = '';

                for (var i = 0; i < resposta.length; i++) {
                    var ranking = resposta[i];
                    var id_ranking = ranking.id;
                    var apelido_rank = ranking.apelido;
                    var acertos_rank = ranking.max_acertos;
                    var total_rank = ranking.total_acertos;

                    if (id_ranking === parseInt(usuario)) {
                        divPosicaoUser.innerHTML = `<div class="player" style=" width: 100%;">
                <img src="https://cdn-icons-png.flaticon.com/128/149/149071.png" alt="">
                <a style="text-decoration: none; color: #402610;">
                    <h4>Você: @${ranking.apelido}</h4>
                </a>
                <div class="dados">
                    <p style="color: #f0eff5;"> Se encontra na: ${posicaoUsuario}° Posição; </p>
                </div>
                <div class="dados">
                    <p style="color: #f0eff5;"> Possuindo um total de: ${ranking.total_acertos} pontos! </p>
                </div>
            </div>`;
                    }

                    divPosicaoPlayer.innerHTML += `<div class="player" >
            <img src="https://cdn-icons-png.flaticon.com/128/149/149071.png" alt="">
            <a style="text-decoration: none; color: #fff;">
                <h4>@${apelido_rank}</h4>
            </a>
            <div class="dados">
                <p style="color: #f0eff5;"> Se encontra em: ${i + 1}° Posição; </p>
            </div>
            <div class="dados">
                    <p style="color: #f0eff5;"> Com um total de ${ranking.total_acertos} pontos! </p>
                </div>
        </div>`;
                }
            }).catch(function (resposta) {
                console.error(`#ERRO: ${resposta}`);
            });





            // Integração do cadastro - escolha do país de culinária favorita dos usuários
            fetch("/usuarios/exibir", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    usuarioServer: usuario,

                })
            }).then(function (resposta) {
                if (resposta.ok) {
                    if (resposta.status == 204) {
                        alert('nenhuma resposta')

                    }

                    // resposta com todos os resultados
                    resposta.json().then(function (resposta) {
                        console.log("Dados recebidos: ", JSON.stringify(resposta));

                        //lista com todos os resultados
                        for (var i = 0; i < resposta.length; i++) {
                            var usuario = resposta[i];
                            var CulinariaFavorita = usuario.pais;

                            if (CulinariaFavorita == 'IT') {
                                ItaliaCF++
                            } else if (CulinariaFavorita == 'FR') {
                                FrancaCF++
                            } else if (CulinariaFavorita == 'JP') {
                                JapaoCF++
                            } else if (CulinariaFavorita == 'MX') {
                                MexicoCF++
                            } else if (CulinariaFavorita == 'EG') {
                                EgitoCF++
                            } else if (CulinariaFavorita == 'BR') {
                                BrasilCF++
                            } else if (CulinariaFavorita == 'SA') {
                                ArabiaCF++
                            } else if (CulinariaFavorita == 'US') {
                                EuaCF++
                            }
                        }
                        console.log(ItaliaCF)
                        exibirGraficos()

                    });
                } else {
                    throw "Houve um erro na API!";
                }
            })
                .catch(function (resposta) {
                    console.error(resposta);
                });






            // Integração do forum - mostrando os restaurantes que estão sendo publicados
            fetch("/forum/restaurante", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    usuarioServer: usuario,
                })
            }).then(function (resposta) {
                if (resposta.ok) {
                    if (resposta.status == 204) {
                        alert('nenhuma resposta');
                        return;
                    }
                    resposta.json().then(function (resposta) {
                        console.log("Dados recebidos: ", JSON.stringify(resposta));

                        var nomesRestaurantes = [];
                        var qtdPosts = [];

                        for (var i = 0; i < resposta.length; i++) {
                            var restaurante = resposta[i];
                            nomesRestaurantes.push(restaurante.nomeRestaurante);
                            qtdPosts.push(restaurante.qtdPosts);
                        }

                        console.log(nomesRestaurantes);
                        console.log(qtdPosts);

                        // Chama a função para exibir o gráfico
                        exibirGrafico(nomesRestaurantes, qtdPosts);
                    });
                } else {
                    throw new Error("Houve um erro na API!");
                }
            }).catch(function (erro) {
                console.error(erro);
            });


/*
            // Informação para conhecimento pessoal - mostrando em quais games as pessoas obtiveram mais dificuldade em conhecer a cultura;
            fetch("/quiz/pessoalQuiz", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    usuarioServer: usuario,
                })
            }).then(function (resposta) {
                if (resposta.ok) {
                    if (resposta.status == 204) {
                        alert('nenhuma resposta');
                        return;
                    }
                    resposta.json().then(function (resposta) {
                        console.log("Dados recebidos: ", JSON.stringify(resposta));


                        const gameIds = data.map(d => d.game_id);
                        const acertos = data.map(d => d.total_acertos);
                        const erros = data.map(d => d.total_erros);

                        graficoPessoal(gameIds, acertos, erros);
                    });
                } else {
                    throw new Error("Houve um erro na API!");
                }
            }).catch(function (erro) {
                console.error(erro);
            });
*/

        }


        //grafico do forum
        function exibirGrafico(nomesRestaurantes, qtdPosts) {
            if (window.avaliacaoRestaurantesChart) {
                window.avaliacaoRestaurantesChart.destroy();
            }

            const nomeLugar = {
                labels: nomesRestaurantes,
                datasets: [{
                    label: 'Número de Postagens',
                    backgroundColor: '#BB3E03',
                    borderColor: '#860000',
                    data: qtdPosts,
                }]
            };

            const config1 = {
                type: 'line',
                data: nomeLugar,
                options: {}
            };

            window.avaliacaoRestaurantesChart = new Chart(
                document.getElementById('avaliacaoRestaurantes'),
                config1
            );
        }

        /*
        function graficoPessoal(gameIds, acertos, erros){
            
            // Definindo os labels do gráfico
    const AcertoQuiz = gameIds.map(id => `Questão ${id}`);
    
    
    // Configurando os dados do gráfico
    const questoesGeral = {
        labels: AcertoQuiz,
        datasets: [{
            label: 'Erros',
            backgroundColor: '#730023',
            borderColor: '#9B2226',
            data: erros,
        }, {
            label: 'Acertos',
            backgroundColor: '#588157',
            borderColor: '#314d31',
            data: acertos,
        }]
    };

    // Configurando o gráfico
    const config5 = {
        type: 'radar',
        data: questoesGeral,
        options: {
            scales: {
                r: {
                    angleLines: {
                        display: false
                    },
                    suggestedMin: 0
                }
            }
        }
    };

    
    // Criando o gráfico
    const AcertosQuiz = new Chart(
        document.getElementById('AcertosQuiz'),
        config5
    );

    }
    */

        

        // configurações do chart.js
        function exibirGraficos() {

            //gráfico do cadastro
            const CulinariaFavorita = [
                'Itália',
                'França',
                'Japão',
                'México',
                'Egito',
                'Brasil',
                'Arábia',
                'EUA',
            ];

            const pais = {
                labels: CulinariaFavorita,
                datasets: [{
                    label: '',
                    backgroundColor: '#CA6702',
                    borderColor: '#f0ad4e',
                    data: [ItaliaCF, FrancaCF, JapaoCF, MexicoCF, EgitoCF, BrasilCF, ArabiaCF, EuaCF],
                }]
            };

            const config3 = {
                type: 'bar',
                data: pais,
                options: {}
            };


            const CulinariaFav = new Chart(
                document.getElementById('CulinariaFav'),
                config3
            );

/*

            //qtd de erros na cruzadinha
            const ErroCruzadinha = [
                'Itália',
                'França',
                'Japão',
                'México',
                'Egito',
                'Brasil',
                'Arábia',
                'EUA',
            ];

            const questao = {
                labels: ErroCruzadinha,
                datasets: [{
                    label: 'Erros',
                    backgroundColor: '#730023',
                    borderColor: '#9B2226',
                    data: [5, 0, 5, 3, 4, 5, 7, 6, 5, 0, 5, 3, 4, 5, 7, 6],
                }, {
                    label: 'Acertos',
                    backgroundColor: '#588157',
                    borderColor: '#314d31',
                    data: [10, 15, 10, 12, 11, 10, 8, 9, 10, 15, 10, 12, 11, 10, 8, 9],
                }]
            };

            const config6 = {
                type: 'radar',
                data: questao,
                options: {}
            };


            const ErrosCruzadinha = new Chart(
                document.getElementById('ErrosCruzadinha'),
                config6
            );

            */
        }

    </script>

</body>

</html>